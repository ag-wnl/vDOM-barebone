var N=(s,a={},...u)=>({type:s,props:a,children:u}),y=class{key;constructor(a){this.key=a}},L=s=>{let a=new Proxy({},{get(t,d){return new y(d)}}),u=s(a),l=[],e=g(u,l);return t=>{let d=new Array(l.length),m=new Map;return{mount:f=>{let p=e.cloneNode(!0);f.textContent="",f.appendChild(p);for(let r=0;r<l.length;r++){let n=l[r],o=p;for(let i=0;i<n.path.length;i++)o=o.childNodes[n.path[i]];d[r]=o;let c=t[n.hole];if(n.type==="attribute")if(n.attribute.startsWith("on")){let i=n.attribute.slice(2).toLowerCase(),h=typeof c=="function"?c:t[c];h&&(o.addEventListener(i,h),m.set(i,h))}else o[n.attribute]=c;else if(n.type==="child")if(c.mount&&typeof c.mount=="function")c.mount(o);else{let i=document.createTextNode(c);o.insertBefore(i,o.childNodes[n.index])}}},patch:f=>{for(let p=0;p<l.length;p++){let r=l[p],n=t[r.hole],o=f.props[r.hole];if(n===o)continue;let c=d[p];if(r.type==="attribute")if(r.attribute.startsWith("on")){let i=r.attribute.slice(2).toLowerCase(),h=m.get(i),b=typeof o=="function"?o:f.props[o];h&&(c.removeEventListener(i,h),m.delete(i)),b&&(c.addEventListener(i,b),m.set(i,b))}else c[r.attribute]=o;else r.type==="child"&&(n&&typeof n=="object"&&n.patch?n.patch(f.edits[p].hole):c.childNodes[r.index].textContent=String(o))}},props:t,edits:l}}},g=(s,a=[],u=[])=>{if(typeof s=="string")return document.createTextNode(s);let l=document.createElement(s.type);if(s.props)for(let e in s.props){let t=s.props[e];if(e.startsWith("on")){if(t instanceof y)a.push({type:"attribute",path:u,attribute:e,hole:t.key});else if(typeof t=="function"){a.push({type:"attribute",path:u,attribute:e,hole:t});let d=e.slice(2).toLowerCase();l.addEventListener(d,t)}continue}t instanceof y?a.push({type:"attribute",path:u,attribute:e,hole:t.key}):l[e]=t}for(let e=0;e<s.children?.length;e++){let t=s.children[e];t instanceof y?a.push({type:"child",path:u,index:e,hole:t.key}):l.appendChild(g(t,a,[...u,e]))}return l};export{L as block,N as h,g as render};
//# sourceMappingURL=index.mjs.map